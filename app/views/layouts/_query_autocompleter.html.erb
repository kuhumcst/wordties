<script type="text/javascript">
 // Create a new YUI instance and populate it with the required modules.
 YUI().use('event', 'cookie', 'datasource', 'autocomplete', 'autocomplete-highlighters', function (Y) {
     var searchItemTemplate = 
 	"<div>" +
 	  "<span>{before}</span>" +
      "<span style='font-weight: bold'>{query}</span>" +
      "<span>{after}</span>" +
    "</div>";
    
    function selectSearchTerm(e) {
    	e.preventDefault();
    	Y.one('#queryInput').set('value', e.result.raw.term);
    	var filter = Y.one('#queryFilter input[name=filter_option]:checked').get("value")
    	if(filter != 'fullsearch') filter = filter.substring(filter.lastIndexOf('_')+1, filter.length);
    	gotoWord(e.result.raw.term, filter);
    	
    	return false;
    }
    
    function searchFormatter(query, results) {
	   return Y.Array.map(results, function (result) {
	    var searchResult = result.raw.term;
	
	    // Use string substitution to fill out the search template and
	    // return an HTML string for this result.
	    var matchIdx = searchResult.indexOf(query)
	        
	    return Y.Lang.sub(searchItemTemplate, {
	    	query:	query,
	    	before: searchResult.substr(0, matchIdx),
	        after: 	searchResult.substr(matchIdx + query.length)
	    });
	  });
	 }
	 
	 function doChangeEvent(val) {
	 	oDS.set("source", "<%= word_suggestions_path %>/"+val);
        oDS.cache.flush();
        var exdate = new Date();
		exdate.setHours(exdate.getHours()+4);
    	// reset cookie
        Y.Cookie.set("_yui_form_option_filter", val, { expires: exdate });
	 }
	 
    // Add the yui3-skin-sam class to the body so the default
    // AutoComplete widget skin will be applied.
    Y.one('body').addClass('yui3-skin-sam');
    
    // Use an DataSource
    var oDS = new Y.DataSource.IO({source: "<%= word_suggestions_path %>/" + Y.one('#queryFilter input[name=filter_option]:checked').get("value")});
	oDS.plug({fn:Y.Plugin.DataSourceCache, cfg:{max:5}});
    oDS.plug(Y.Plugin.DataSourceTextSchema, {
   	 schema: {
   	 	resultDelimiter: "\n",
    	fieldDelimiter: "\t",
    	resultFields: [{key:"term"}]
   	 }
    });
    
   // AutoComplete instance 
   Y.one('#queryInput').plug(Y.Plugin.AutoComplete, {
    resultHighlighter: 'wordMatch',
    resultFormatter: searchFormatter,
    requestTemplate: '/{query}',
    source: oDS
   });
   
   Y.one('#queryInput').ac.on("select", selectSearchTerm);
   
   Y.all('#queryFilter input[type=radio]').each(function (node) {
    var saved_val = Y.Cookie.get("_yui_form_option_filter", String);
    node.on('change', function () {
        var val = this.get('value');
        doChangeEvent(val);
    })
	if(saved_val == node.get("value")) { 
	  node.set("checked", true);
	  doChangeEvent(saved_val);
    }
   });
 });
</script>